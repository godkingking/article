import{r as f,j as e,k as o}from"./index-Cfmv2_6b.js";import{H as g,S as w,T,C as N}from"./theme-switch-BEuUnAg7.js";import{I as S,M as k}from"./image-mode-switch-BZ6N5lAh.js";import{u as x}from"./useQuery-CMxuRuqC.js";import{p as b,g as v}from"./task-B-6I4xpx.js";import{B as y}from"./badge-CdzfjR64.js";import{S as _,f as C,g as z,h as q,j as E,i as d,T as F,a as H,b as l,c as r,d as I,e as a}from"./table-Bw3d3W1i.js";import{T as m,z as h,A as p}from"./dropdown-menu-BzzqwK3A.js";import{C as L}from"./pagination-DVhMTSPs.js";import"./index-BcvOfbyX.js";import"./index-LD0V451S.js";import"./index-Gxvz5Rn7.js";import"./index-Br095eJ-.js";import"./createLucideIcon-CfGVfKYJ.js";import"./separator-DkYoixfM.js";import"./index-DyZmGQBD.js";import"./check-CtsTkJS3.js";import"./eye-B-A0tRox.js";import"./request-CKtXVA2v.js";import"./index-BdQq_4o_.js";import"./index-2_VpRaJt.js";import"./newspaper-ovjArt15.js";import"./scroll-area-C_xGIT5C.js";import"./arrow-right-Cdh2GvcD.js";const B=20;function M(){const[i,n]=f.useState({task_func:"",page:1,pageSize:20}),{data:c,isLoading:j}=x({queryKey:["task-log",i],queryFn:async()=>(await b(i)).data,staleTime:300*1e3}),{data:u}=x({queryKey:["tasks"],queryFn:async()=>(await v()).data,staleTime:300*1e3});return e.jsxs("div",{className:"flex h-full flex-col overflow-hidden",children:[e.jsx("div",{className:"sticky top-0 z-30 mb-2",children:e.jsxs(_,{value:i.task_func,onValueChange:s=>n(t=>({...t,task_func:s})),children:[e.jsx(C,{className:"w-full max-w-48",children:e.jsx(z,{placeholder:"选择一个函数"})}),e.jsx(q,{children:e.jsxs(E,{children:[e.jsx(d,{value:"all",children:"全部函数"}),u?.map((s,t)=>e.jsx(d,{value:s.task_func,children:s.task_name},t))]})})]})}),e.jsx("div",{className:"flex-1 overflow-auto rounded-lg border",children:e.jsxs(F,{children:[e.jsx(H,{children:e.jsxs(l,{children:[e.jsx(r,{children:"任务名称"}),e.jsx(r,{children:"任务函数"}),e.jsx(r,{children:"开始时间"}),e.jsx(r,{children:"结束时间"}),e.jsx(r,{children:"耗时"}),e.jsx(r,{className:"max-w-[300px]",children:"输出信息"}),e.jsx(r,{children:"执行结果"}),e.jsx(r,{children:"异常信息"})]})}),e.jsxs(I,{children:[j&&e.jsx(l,{children:e.jsx(a,{colSpan:9,className:"text-center",children:"加载中..."})}),c?.items.length===0&&e.jsx(l,{children:e.jsx(a,{colSpan:9,className:"text-center",children:"暂无数据"})}),c?.items.map(s=>e.jsxs(l,{children:[e.jsx(a,{children:s.task_name}),e.jsx(a,{children:s.task_func}),e.jsx(a,{children:o(s.start_time)}),e.jsx(a,{children:o(s.end_time)}),e.jsxs(a,{children:[s.execute_seconds,"秒"]}),e.jsx(a,{className:"max-w-[300px] overflow-hidden",children:e.jsxs(m,{children:[e.jsx(h,{asChild:!0,children:e.jsx("span",{className:"cursor-pointer truncate",children:s.execute_result})}),e.jsx(p,{className:"max-h-[400px] max-w-[600px] overflow-auto",side:"left",children:e.jsx("pre",{className:"text-xs whitespace-pre-wrap",children:JSON.stringify(JSON.parse(s.execute_result),null,2)})})]})}),e.jsx(a,{children:e.jsx(y,{className:s.success?"bg-green-500 hover:bg-green-500":"bg-red-500 hover:bg-red-500",children:s.success?"成功":"失败"})}),e.jsx(a,{children:e.jsxs(m,{children:[e.jsx(h,{asChild:!0,children:e.jsx("span",{className:"cursor-pointer truncate",children:s.error})}),e.jsx(p,{className:"max-h-[400px] max-w-[600px] overflow-auto",side:"left",children:e.jsx("pre",{className:"text-xs whitespace-pre-wrap",children:s.error})})]})})]},s.id))]})]})}),e.jsx("div",{className:"sticky bottom-0 z-30 mt-2",children:e.jsx(L,{page:i.page,total:c?.total||0,pageSize:B,onChange:s=>n(t=>({...t,page:s}))})})]})}function A(){return e.jsxs(e.Fragment,{children:[e.jsxs(g,{fixed:!0,children:[e.jsx(w,{}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(S,{}),e.jsx(T,{}),e.jsx(N,{})]})]}),e.jsxs(k,{fixed:!0,children:[e.jsx("div",{className:"flex flex-wrap items-end justify-between gap-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"任务调度记录"}),e.jsx("p",{className:"text-muted-foreground",children:"查看任务执行结果"})]})}),e.jsx(M,{})]})]})}const oe=A;export{oe as component};
