import{j as e,B as w,r as S,h as A,o as H,t as R,s as x,x as O}from"./index-Cfmv2_6b.js";import{C as $}from"./content-section-kRkJoNBb.js";import{u as W,f as _,F as Z,a as h,b as u,c as j,d as f,e as G}from"./form-z2H_9us6.js";import{a as J}from"./zod-CNSUHLbF.js";import{u as T}from"./useQuery-CMxuRuqC.js";import{g as U}from"./article-CnuUsIAy.js";import{f as X}from"./config-C7CtpGcz.js";import{r as C}from"./request-CKtXVA2v.js";import{u as Y}from"./index-2_VpRaJt.js";import{I as ee}from"./input-DXM_P0Jl.js";import{T as se,a as ae,b as p,c as d,d as ne,e as c,S as g,f as y,g as N,h as v,i as m}from"./table-Bw3d3W1i.js";import{L as re,E as te,R as le}from"./empty-BQG2kqd2.js";import{P as K,C as V}from"./confirm-button-DkBDyM36.js";import{T as P,P as ce}from"./trash-2-CxAI5eJB.js";import{C as oe,c as ie,e as de}from"./card-5k6FjxUL.js";import{c as me}from"./createLucideIcon-CfGVfKYJ.js";import{R as xe}from"./route-CoIfshVO.js";import"./index-DyZmGQBD.js";import"./index-BcvOfbyX.js";import"./index-Gxvz5Rn7.js";import"./index-BdQq_4o_.js";import"./index-Br095eJ-.js";import"./check-CtsTkJS3.js";import"./loader-circle-BuL4oDgy.js";import"./alert-dialog-CXgTf4ao.js";const he=[["path",{d:"M17 3v10",key:"15fgeh"}],["path",{d:"m12.67 5.5 8.66 5",key:"1gpheq"}],["path",{d:"m12.67 10.5 8.66-5",key:"1dkfa6"}],["path",{d:"M9 17a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2z",key:"swwfx4"}]],ue=me("regex",he);function je(){return C({url:"/rules/"})}function fe(r){return C({url:"/rules/",method:"post",data:r})}function pe(r){return C({url:"/rules/",method:"put",data:r})}function ge(r){return C({url:`/rules/${r}`,method:"delete"})}function ye({data:r,onEdit:o,onDelete:i,isLoading:l}){return e.jsx("div",{className:"rounded-lg border",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(p,{children:[e.jsx(d,{children:"ID"}),e.jsx(d,{children:"板块"}),e.jsx(d,{children:"分类"}),e.jsx(d,{children:"正则"}),e.jsx(d,{children:"下载器"}),e.jsx(d,{children:"保存路径"}),e.jsx(d,{children:"操作"})]})}),e.jsxs(ne,{children:[l&&e.jsx(p,{children:e.jsx(c,{colSpan:9,className:"text-center",children:"加载中..."})}),r?.length===0&&e.jsx(p,{children:e.jsx(c,{colSpan:9,className:"text-center",children:"暂无数据"})}),r?.map(n=>e.jsxs(p,{children:[e.jsx(c,{children:n.id}),e.jsx(c,{children:n.section}),e.jsx(c,{children:n.category}),e.jsx(c,{children:n.regex}),e.jsx(c,{children:n.downloader}),e.jsx(c,{children:n.save_path}),e.jsxs(c,{children:[e.jsx(w,{variant:"outline",size:"icon",className:"mr-2",onClick:()=>o(n),children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(V,{variant:"destructive",title:"删除规则",description:"删除后数据将无法恢复，是否确认？",triggerText:e.jsx(P,{className:"h-4 w-4"}),onConfirm:()=>i(n.id)})]})]},n.id))]})]})})}function Ne({data:r,onEdit:o,onDelete:i,isLoading:l}){return e.jsxs("div",{className:"space-y-2",children:[l&&e.jsx(re,{}),r?.length===0&&e.jsx(te,{}),r?.map(n=>e.jsxs(oe,{className:"w-full max-w-sm",children:[e.jsx(ie,{children:e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-muted-foreground",children:"板块"}),e.jsx("dd",{className:"text-sm",children:n.section})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-muted-foreground",children:"分类"}),e.jsx("dd",{className:"text-sm",children:n.category})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-muted-foreground",children:"正则"}),e.jsx("dd",{className:"text-sm",children:n.regex})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-muted-foreground",children:"下载器"}),e.jsx("dd",{className:"text-sm",children:n.downloader})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-sm text-muted-foreground",children:"保存路径"}),e.jsx("dd",{className:"text-sm",children:n.save_path})]})]})}),e.jsxs(de,{className:"flex justify-end gap-2",children:[e.jsx(w,{variant:"outline",size:"icon",onClick:()=>o(n),children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(V,{variant:"outline",className:"text-destructive",title:"删除规则",description:"删除后数据将无法恢复，是否确认？",triggerText:e.jsx(P,{className:"h-4 w-4"}),onConfirm:()=>i(n.id)})]})]},n.id))]})}const ve=H({id:O(),section:x().min(1,"选择板块"),category:x().min(1,"选择类目"),regex:x(),downloader:x().min(1,"选择下载器"),save_path:x().min(1,"选择保存目录")}),D={id:0,section:"",category:"",regex:"",downloader:"",save_path:""};function we(){const[r,o]=S.useState(null),[i,l]=S.useState(!1),n=Y(),b=A(),t=W({resolver:J(ve),defaultValues:D}),{data:F,isLoading:q}=T({queryKey:["rules"],queryFn:async()=>(await je()).data,staleTime:300*1e3}),{data:L}=T({queryKey:["categories"],queryFn:async()=>(await U()).data,staleTime:300*1e3}),k=_({control:t.control,name:"section"}),Q=L?.find(s=>s.name==k)?.categories,{data:E}=T({queryKey:["downloaders"],queryFn:async()=>(await X()).data,staleTime:300*1e3}),I=_({control:t.control,name:"downloader"}),B=E?.find(s=>s.id==I)?.save_paths;S.useEffect(()=>{r?t.reset(r):i&&t.reset(D)},[r,t,i]);const M=async s=>{const a=await ge(s);a.code===0&&(R.success(a.message),b.invalidateQueries({queryKey:["rules"]}))},z=async s=>{if(r){const a=await pe(s);a.code===0&&(R.success(a.message),b.invalidateQueries({queryKey:["rules"]}),l(!1))}else{const a=await fe(s);a.code===0&&(R.success(a.message),b.invalidateQueries({queryKey:["rules"]}),l(!1))}};return e.jsxs(e.Fragment,{children:[e.jsx(le,{title:r?"编辑规则":"创建新规则",open:i,onOpenChange:l,trigger:e.jsxs(w,{onClick:()=>o(null),className:"rounded-full",children:[e.jsx(ce,{})," 新增规则"]}),children:e.jsx(Z,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(z),className:"space-y-4",children:[e.jsx(h,{control:t.control,name:"section",render:({field:s})=>e.jsxs(u,{children:[e.jsx(j,{children:"板块"}),e.jsxs(g,{onValueChange:s.onChange,value:s.value,children:[e.jsx(f,{children:e.jsx(y,{className:"w-full",children:e.jsx(N,{placeholder:"选择板块"})})}),e.jsxs(v,{className:"w-full",children:[e.jsx(m,{value:"ALL",children:"不限制板块"}),L?.map(a=>e.jsx(m,{value:a.name,children:a.name},a.name))]})]}),e.jsx(G,{})]})}),e.jsx(h,{control:t.control,name:"category",render:({field:s})=>e.jsxs(u,{children:[e.jsx(j,{children:"分类"}),e.jsxs(g,{value:s.value,disabled:!k,onValueChange:s.onChange,children:[e.jsx(f,{children:e.jsx(y,{className:"w-full",children:e.jsx(N,{placeholder:"选择分类"})})}),e.jsxs(v,{className:"w-full",children:[e.jsx(m,{value:"ALL",children:"不限制类目"}),Q?.map(a=>e.jsx(m,{value:a.name,children:a.name},a.name))]})]})]})}),e.jsx(h,{control:t.control,name:"regex",render:({field:s})=>e.jsxs(u,{className:"col-span-full",children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"匹配正则（可选）"]}),e.jsx(f,{children:e.jsx(ee,{...s,placeholder:"^[A-Z]{3,5}-\\\\d{3,4}$",className:"font-mono"})})]})}),e.jsx(h,{control:t.control,name:"downloader",render:({field:s})=>e.jsxs(u,{children:[e.jsx(j,{children:"下载器"}),e.jsxs(g,{value:s.value,onValueChange:s.onChange,children:[e.jsx(f,{children:e.jsx(y,{className:"w-full",children:e.jsx(N,{placeholder:"选择下载器"})})}),e.jsx(v,{className:"w-full",children:E?.map(a=>e.jsx(m,{value:a.id,children:a.id},a.id))})]})]})}),e.jsx(h,{control:t.control,name:"save_path",render:({field:s})=>e.jsxs(u,{children:[e.jsx(j,{children:"存储路径"}),e.jsxs(g,{value:s.value,disabled:!I,onValueChange:s.onChange,children:[e.jsx(f,{children:e.jsx(y,{className:"w-full",children:e.jsx(N,{placeholder:"选择路径"})})}),e.jsx(v,{className:"w-full",children:B?.map(a=>e.jsx(m,{value:a.path,children:a.path},a.path))})]})]})}),e.jsx(w,{type:"submit",className:"w-full",children:"提交"})]})})}),n?e.jsx(Ne,{data:F,onEdit:s=>{o(s),l(!0)},onDelete:s=>M(s),isLoading:q}):e.jsx(ye,{data:F,onEdit:s=>{o(s),l(!0)},onDelete:s=>M(s),isLoading:q})]})}function Ce(){return e.jsx($,{title:"下载目录路由配置",desc:"管理类目与下载目录的关系,用于自动化操作",icon:e.jsx(xe,{className:"h-5 w-5 text-primary"}),children:e.jsx(we,{})})}const Ge=Ce;export{Ge as component};
